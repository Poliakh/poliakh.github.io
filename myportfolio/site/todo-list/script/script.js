"use strict";

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const todoData = [{
  label: 'Wake ip',
  done: true
}, {
  label: 'Drinck a coffee',
  done: false
}, {
  label: 'create todolist',
  done: false
}];
!localStorage.getItem(['todoData']) ? localStorage['todoData'] = JSON.stringify(todoData) : '';

class TodoApp {
  constructor(idTodo, clNameList, idItem, clsLabel, clsCheck) {
    _defineProperty(this, "getClearItem", id => {
      const item = document.getElementById(id);
      const newItem = item.cloneNode(true);
      item.parentElement.removeChild(item);
      newItem.removeAttribute('id');
      return newItem;
    });

    _defineProperty(this, "createItem", (_ref) => {
      let {
        label,
        done
      } = _ref;
      const todoItem = this.cleanItem.cloneNode(true);
      todoItem.querySelector('.item__label').innerHTML = label;
      let item = todoItem.querySelector(".".concat(this.clsCheck)).checked = done;
      return todoItem;
    });

    _defineProperty(this, "addItem", () => {
      this.todo.addEventListener('submit', e => {
        e.preventDefault();
        let value = document.forms.todos[0].value;

        if (value) {
          const data = {
            label: value,
            done: false
          };
          this.listItem.appendChild(this.createItem(data));
          document.querySelector('.form__input').value = '';
          this.setStorage();
        }
      });
    });

    _defineProperty(this, "changeStatus", () => {
      this.todo.addEventListener('change', () => {
        this.setStorage();
      });
    });

    _defineProperty(this, "removeItem", () => {
      this.listItem.addEventListener('click', (_ref2) => {
        let {
          target
        } = _ref2;

        if (target.closest('.delete')) {
          const selectedItem = target.closest('li');
          const children = this.listItem.querySelectorAll('li');
          children.forEach(item => {
            if (item === selectedItem) {
              this.listItem.removeChild(item);
              this.setStorage();
            }

            ;
          });
        }

        ;
      });
    });

    _defineProperty(this, "editItem", () => {
      this.listItem.addEventListener('click', (_ref3) => {
        let {
          target
        } = _ref3;

        if (target.closest('.edit')) {
          const parent = target.closest('.edit').parentElement,
                label = parent.querySelector('.item__label'),
                input = parent.querySelector('.ghost__input'),
                that = this;
          input.value = label.innerHTML;
          parent.classList.add('redact');
          input.focus();
          parent.addEventListener('click', action);
          parent.addEventListener('keyup', action);

          function action(_ref4) {
            let {
              target,
              key
            } = _ref4;

            if (target.closest('.ghost__btn-ok') || key === "Enter") {
              label.innerHTML = input.value;
              parent.classList.remove('redact');
              that.setStorage();
              removeEvent();
            }

            ;

            if (target.closest('.ghost__btn-cancel') || key === "Escape") {
              parent.classList.remove('redact');
              removeEvent();
            }

            ;
          }

          ;

          function removeEvent() {
            parent.removeEventListener('click', action);
            parent.removeEventListener('keyup', action);
          }

          ;
        }

        ;
      });
    });

    _defineProperty(this, "createData", () => {
      const list = Array.from(this.listItem.children);
      return list.map(item => {
        return {
          label: item.querySelector(".".concat(this.clsLabel)).innerHTML,
          done: item.querySelector(".".concat(this.clsCheck)).checked
        };
      });
    });

    _defineProperty(this, "setStorage", () => {
      const data = this.createData();
      localStorage[this.keyLocalSt] = JSON.stringify(data);
    });

    _defineProperty(this, "getStorage", () => {
      return localStorage.getItem([this.keyLocalSt]) ? JSON.parse(localStorage[this.keyLocalSt]) : '';
    });

    _defineProperty(this, "createList", () => {
      const dataList = this.getStorage(),
            listElements = document.createDocumentFragment();
      dataList.forEach(item => {
        listElements.appendChild(this.createItem(item));
      });
      this.listItem.appendChild(listElements);
    });

    this.todo = document.getElementById(idTodo);
    this.listItem = this.todo.querySelector(".".concat(clNameList));
    this.clsLabel = clsLabel;
    this.clsCheck = clsCheck;
    this.cleanItem = this.getClearItem(idItem);
    this.keyLocalSt = 'todoData';
    this.addItem();
    this.removeItem();
    this.createList();
    this.changeStatus();
    this.editItem();
  }

}

;
const todo = new TodoApp('todoApp', 'list', 'clearItem', 'item__label', 'item__check');
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJ0b2RvRGF0YSIsImxhYmVsIiwiZG9uZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiVG9kb0FwcCIsImNvbnN0cnVjdG9yIiwiaWRUb2RvIiwiY2xOYW1lTGlzdCIsImlkSXRlbSIsImNsc0xhYmVsIiwiY2xzQ2hlY2siLCJpZCIsIml0ZW0iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibmV3SXRlbSIsImNsb25lTm9kZSIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsInJlbW92ZUF0dHJpYnV0ZSIsInRvZG9JdGVtIiwiY2xlYW5JdGVtIiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNoZWNrZWQiLCJ0b2RvIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiZm9ybXMiLCJ0b2RvcyIsImRhdGEiLCJsaXN0SXRlbSIsImFwcGVuZENoaWxkIiwiY3JlYXRlSXRlbSIsInNldFN0b3JhZ2UiLCJ0YXJnZXQiLCJjbG9zZXN0Iiwic2VsZWN0ZWRJdGVtIiwiY2hpbGRyZW4iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInBhcmVudCIsImlucHV0IiwidGhhdCIsImNsYXNzTGlzdCIsImFkZCIsImZvY3VzIiwiYWN0aW9uIiwia2V5IiwicmVtb3ZlIiwicmVtb3ZlRXZlbnQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibGlzdCIsIkFycmF5IiwiZnJvbSIsIm1hcCIsImNyZWF0ZURhdGEiLCJrZXlMb2NhbFN0IiwicGFyc2UiLCJkYXRhTGlzdCIsImdldFN0b3JhZ2UiLCJsaXN0RWxlbWVudHMiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiZ2V0Q2xlYXJJdGVtIiwiYWRkSXRlbSIsInJlbW92ZUl0ZW0iLCJjcmVhdGVMaXN0IiwiY2hhbmdlU3RhdHVzIiwiZWRpdEl0ZW0iXSwibWFwcGluZ3MiOiI7Ozs7QUFD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QixDQUFqQjtBQUNBLFNBQUttRCxVQUFMLEdBQWtCLFVBQWxCO0FBQ0EsU0FBS08sT0FBTDtBQUNBLFNBQUtDLFVBQUw7QUFDQSxTQUFLQyxVQUFMO0FBQ0EsU0FBS0MsWUFBTDtBQUNBLFNBQUtDLFFBQUw7QUFDQTs7QUFiWTs7QUE4SGI7QUFFRCxNQUFNN0MsSUFBSSxHQUFHLElBQUlyQixPQUFKLENBQVksU0FBWixFQUF1QixNQUF2QixFQUErQixXQUEvQixFQUE0QyxhQUE1QyxFQUEyRCxhQUEzRCxDQUFiIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmNvbnN0IHRvZG9EYXRhID0gW1xyXG5cdHsgbGFiZWw6ICdXYWtlIGlwJywgZG9uZTogdHJ1ZSwgfSxcclxuXHR7IGxhYmVsOiAnRHJpbmNrIGEgY29mZmVlJywgZG9uZTogZmFsc2UsIH0sXHJcblx0eyBsYWJlbDogJ2NyZWF0ZSB0b2RvbGlzdCcsIGRvbmU6IGZhbHNlLCB9XHJcbl07XHJcbighbG9jYWxTdG9yYWdlLmdldEl0ZW0oWyd0b2RvRGF0YSddKSlcclxuXHQ/IGxvY2FsU3RvcmFnZVsndG9kb0RhdGEnXSA9IEpTT04uc3RyaW5naWZ5KHRvZG9EYXRhKSA6ICcnO1xyXG5cclxuXHJcbmNsYXNzIFRvZG9BcHAge1xyXG5cdGNvbnN0cnVjdG9yKGlkVG9kbywgY2xOYW1lTGlzdCwgaWRJdGVtLCBjbHNMYWJlbCwgY2xzQ2hlY2spIHtcclxuXHRcdHRoaXMudG9kbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkVG9kbyk7XHJcblx0XHR0aGlzLmxpc3RJdGVtID0gdGhpcy50b2RvLnF1ZXJ5U2VsZWN0b3IoYC4ke2NsTmFtZUxpc3R9YCk7XHJcblx0XHR0aGlzLmNsc0xhYmVsID0gY2xzTGFiZWw7XHJcblx0XHR0aGlzLmNsc0NoZWNrID0gY2xzQ2hlY2s7XHJcblx0XHR0aGlzLmNsZWFuSXRlbSA9IHRoaXMuZ2V0Q2xlYXJJdGVtKGlkSXRlbSk7XHJcblx0XHR0aGlzLmtleUxvY2FsU3QgPSAndG9kb0RhdGEnO1xyXG5cdFx0dGhpcy5hZGRJdGVtKCk7XHJcblx0XHR0aGlzLnJlbW92ZUl0ZW0oKTtcclxuXHRcdHRoaXMuY3JlYXRlTGlzdCgpO1xyXG5cdFx0dGhpcy5jaGFuZ2VTdGF0dXMoKTtcclxuXHRcdHRoaXMuZWRpdEl0ZW0oKTtcclxuXHR9O1xyXG5cclxuXHRnZXRDbGVhckl0ZW0gPSAoaWQpID0+IHtcclxuXHRcdGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcblx0XHRjb25zdCBuZXdJdGVtID0gaXRlbS5jbG9uZU5vZGUodHJ1ZSk7XHJcblx0XHRpdGVtLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoaXRlbSk7XHJcblx0XHRuZXdJdGVtLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTtcclxuXHRcdHJldHVybiBuZXdJdGVtO1xyXG5cdH07XHJcblxyXG5cdGNyZWF0ZUl0ZW0gPSAoeyBsYWJlbCwgZG9uZSB9KSA9PiB7XHJcblx0XHRjb25zdCB0b2RvSXRlbSA9IHRoaXMuY2xlYW5JdGVtLmNsb25lTm9kZSh0cnVlKTtcclxuXHRcdHRvZG9JdGVtLnF1ZXJ5U2VsZWN0b3IoJy5pdGVtX19sYWJlbCcpLmlubmVySFRNTCA9IGxhYmVsO1xyXG5cdFx0bGV0IGl0ZW0gPSB0b2RvSXRlbS5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLmNsc0NoZWNrfWApLmNoZWNrZWQgPSBkb25lO1xyXG5cdFx0cmV0dXJuIHRvZG9JdGVtXHJcblx0fTtcclxuXHJcblx0YWRkSXRlbSA9ICgpID0+IHtcclxuXHRcdHRoaXMudG9kby5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdGxldCB2YWx1ZSA9IGRvY3VtZW50LmZvcm1zLnRvZG9zWzBdLnZhbHVlO1xyXG5cdFx0XHRpZih2YWx1ZSl7Y29uc3QgZGF0YSA9IHsgbGFiZWw6IHZhbHVlLCBkb25lOiBmYWxzZSB9XHJcblx0XHRcdHRoaXMubGlzdEl0ZW0uYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVJdGVtKGRhdGEpKTtcclxuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1fX2lucHV0JykudmFsdWUgPSAnJztcclxuXHRcdFx0dGhpcy5zZXRTdG9yYWdlKCk7fVxyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Y2hhbmdlU3RhdHVzID0gKCkgPT4ge1xyXG5cdFx0dGhpcy50b2RvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuXHRcdFx0dGhpcy5zZXRTdG9yYWdlKCk7XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRyZW1vdmVJdGVtID0gKCkgPT4ge1xyXG5cdFx0dGhpcy5saXN0SXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICh7IHRhcmdldCB9KSA9PiB7XHJcblx0XHRcdGlmICh0YXJnZXQuY2xvc2VzdCgnLmRlbGV0ZScpKSB7XHJcblx0XHRcdFx0Y29uc3Qgc2VsZWN0ZWRJdGVtID0gdGFyZ2V0LmNsb3Nlc3QoJ2xpJyk7XHJcblx0XHRcdFx0Y29uc3QgY2hpbGRyZW4gPSB0aGlzLmxpc3RJdGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyk7XHJcblx0XHRcdFx0Y2hpbGRyZW4uZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKGl0ZW0gPT09IHNlbGVjdGVkSXRlbSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmxpc3RJdGVtLnJlbW92ZUNoaWxkKGl0ZW0pO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnNldFN0b3JhZ2UoKTtcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH07XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cdFxyXG5cdGVkaXRJdGVtID0gKCkgPT4ge1xyXG5cdFx0dGhpcy5saXN0SXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICh7IHRhcmdldCB9KSA9PiB7XHJcblx0XHRcdGlmICh0YXJnZXQuY2xvc2VzdCgnLmVkaXQnKSkge1xyXG5cdFx0XHRcdGNvbnN0IHBhcmVudCA9IHRhcmdldC5jbG9zZXN0KCcuZWRpdCcpLnBhcmVudEVsZW1lbnQsXHJcblx0XHRcdFx0XHRsYWJlbCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuaXRlbV9fbGFiZWwnKSxcclxuXHRcdFx0XHRcdGlucHV0ID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5naG9zdF9faW5wdXQnKSxcclxuXHRcdFx0XHRcdHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdFx0XHRpbnB1dC52YWx1ZSA9IGxhYmVsLmlubmVySFRNTDtcclxuXHRcdFx0XHRwYXJlbnQuY2xhc3NMaXN0LmFkZCgncmVkYWN0Jyk7XHJcblx0XHRcdFx0aW5wdXQuZm9jdXMoKTtcclxuXHJcblx0XHRcdFx0cGFyZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWN0aW9uKTtcclxuXHRcdFx0XHRwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBhY3Rpb24pO1xyXG5cclxuXHRcdFx0XHRmdW5jdGlvbiBhY3Rpb24gKHsgdGFyZ2V0LCBrZXkgfSl7XHJcblx0XHRcdFx0XHRpZiAodGFyZ2V0LmNsb3Nlc3QoJy5naG9zdF9fYnRuLW9rJykgfHwga2V5ID09PSBcIkVudGVyXCIpIHtcclxuXHRcdFx0XHRcdFx0bGFiZWwuaW5uZXJIVE1MID0gaW5wdXQudmFsdWU7XHJcblx0XHRcdFx0XHRcdHBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdyZWRhY3QnKTtcclxuXHRcdFx0XHRcdFx0dGhhdC5zZXRTdG9yYWdlKCk7XHJcblx0XHRcdFx0XHRcdHJlbW92ZUV2ZW50KCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0aWYgKHRhcmdldC5jbG9zZXN0KCcuZ2hvc3RfX2J0bi1jYW5jZWwnKXx8IGtleSA9PT0gXCJFc2NhcGVcIikge1xyXG5cdFx0XHRcdFx0XHRwYXJlbnQuY2xhc3NMaXN0LnJlbW92ZSgncmVkYWN0Jyk7XHJcblx0XHRcdFx0XHRcdHJlbW92ZUV2ZW50KCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH07XHJcblx0XHRcdFx0ZnVuY3Rpb24gcmVtb3ZlRXZlbnQoKXtcclxuXHRcdFx0XHRcdHBhcmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGFjdGlvbilcclxuXHRcdFx0XHRcdHBhcmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIGFjdGlvbilcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9O1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Y3JlYXRlRGF0YSA9ICgpID0+IHtcclxuXHRcdGNvbnN0IGxpc3QgPSBBcnJheS5mcm9tKHRoaXMubGlzdEl0ZW0uY2hpbGRyZW4pO1xyXG5cdFx0cmV0dXJuIGxpc3QubWFwKGl0ZW0gPT4ge1xyXG5cdFx0XHRyZXR1cm4ge1xyXG5cdFx0XHRcdGxhYmVsOiBpdGVtLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuY2xzTGFiZWx9YCkuaW5uZXJIVE1MLFxyXG5cdFx0XHRcdGRvbmU6IGl0ZW0ucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5jbHNDaGVja31gKS5jaGVja2VkXHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0fVxyXG5cclxuXHRzZXRTdG9yYWdlID0gKCkgPT4ge1xyXG5cdFx0Y29uc3QgZGF0YSA9IHRoaXMuY3JlYXRlRGF0YSgpO1xyXG5cdFx0bG9jYWxTdG9yYWdlW3RoaXMua2V5TG9jYWxTdF0gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuXHJcblx0fTtcclxuXHJcblx0Z2V0U3RvcmFnZSA9ICgpID0+IHtcclxuXHRcdHJldHVybiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oW3RoaXMua2V5TG9jYWxTdF0pKSA/IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlW3RoaXMua2V5TG9jYWxTdF0pIDogJyc7XHJcblx0fTtcclxuXHJcblx0Y3JlYXRlTGlzdCA9ICgpID0+IHtcclxuXHRcdGNvbnN0IGRhdGFMaXN0ID0gdGhpcy5nZXRTdG9yYWdlKCksXHJcblx0XHRcdGxpc3RFbGVtZW50cyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcclxuXHRcdGRhdGFMaXN0LmZvckVhY2goaXRlbSA9PiB7XHJcblx0XHRcdGxpc3RFbGVtZW50cy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUl0ZW0oaXRlbSkpO1xyXG5cdFx0fSk7XHJcblx0XHR0aGlzLmxpc3RJdGVtLmFwcGVuZENoaWxkKGxpc3RFbGVtZW50cyk7XHJcblx0fVxyXG5cclxufTtcclxuXHJcbmNvbnN0IHRvZG8gPSBuZXcgVG9kb0FwcCgndG9kb0FwcCcsICdsaXN0JywgJ2NsZWFySXRlbScsICdpdGVtX19sYWJlbCcsICdpdGVtX19jaGVjaycpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwiZmlsZSI6InNjcmlwdC5qcyJ9
